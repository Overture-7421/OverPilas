<!DOCTYPE html>
<html>
<head>
    <title>Registro de Pilas</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background-color: #E6E0F8; /* morado clarito */
            text-align: center; 
            margin: 50px; 
        }
        h1, h2 { color: #4B0082; } /* morado oscuro */
        form { margin-bottom: 30px; }
        select, input { margin: 5px; padding: 8px; width: 200px; }
        
        /* Contenedor para las tres secciones lado a lado */
        .formularios-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .registro-section, .pila-uso-section, .recibir-section {
            flex: 1;
            max-width: 300px;
            min-width: 250px;
        }
        
        .registro-section {
            background-color: #F3F0FF;
            border: 2px solid #9370DB;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 250px;
            text-align: center;
        }
        
        .registro-section h2 {
            color: #4B0082;
            margin-top: 0;
        }
        
        /* Estilos para campos en l√≠nea */
        .campo-linea {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 8px 0;
            gap: 10px;
        }
        
        .campo-linea label {
            flex: 1;
            text-align: left;
            font-weight: normal;
        }
        
        .campo-linea select,
        .campo-linea input {
            flex: 1;
            margin: 0;
        }
        button { padding: 8px 15px; background-color: #9370DB; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #7B68EE; }
        table { margin: 0 auto; border-collapse: collapse; width: 60%; }
        th, td { border: 1px solid #aaa; padding: 10px; text-align: center; }
        th { background-color: #D8BFD8; }
        
        /* Estilo para pila en uso */
        .en-uso {
            color: #059669;
            font-weight: bold;
        }
        
        /* Estilo para pila en cooldown */
        .en-cooldown {
            color: #DC2626;
            font-weight: bold;
        }
        
        /* Estilo para pila lista para conectar */
        .lista-conectar {
            color: #D97706;
            font-weight: bold;
        }
        
        /* Secci√≥n de pila en uso - verde claro */
        .pila-uso-section {
            background-color: #F0FDF4;
            border: 2px solid #22C55E;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 250px;
        }
        
        .pila-uso-section h2 {
            color: #15803D;
            margin-top: 0;
        }
        
        /* Secci√≥n de recibir pila - rojo claro */
        .recibir-section {
            background-color: #FEF2F2;
            border: 2px solid #EF4444;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 250px;
        }
        
        .recibir-section h2 {
            color: #DC2626;
            margin-top: 0;
        }
        
        /* Contenedor para las tablas lado a lado */
        .tablas-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .tabla-section {
            flex: 1;
            max-width: 500px;
            min-width: 400px;
            background-color: #F3F0FF;
            border: 2px solid #9370DB;
            border-radius: 10px;
            padding: 20px;
        }
        
        .tabla-section h2 {
            color: #4B0082;
            margin-top: 0;
        }
        
        .tabla-section table {
            width: 100%;
            margin: 0;
        }
        
        /* Bot√≥n de reiniciar */
        .reiniciar-btn {
            position: fixed;
            bottom: 20px;
            right: 15px;
            background: linear-gradient(135deg, #DC2626, #EF4444);
            color: white;
            border: none;
            padding: 12px 10px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
            font-size: 14px;
        }
        
        .reiniciar-btn:hover {
            background: linear-gradient(135deg, #B91C1C, #DC2626);
            box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);
        }

        /* Bot√≥n de informaci√≥n */
        .info-btn {
            position: fixed;
            bottom: 20px;
            left: 15px;
            background: linear-gradient(135deg, #2563EB, #3B82F6);
            color: white;
            border: none;
            padding: 12px 10px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
            font-size: 14px;
        }
        
        .info-btn:hover {
            background: linear-gradient(135deg, #1D4ED8, #2563EB);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
        }

        /* √öltima actualizaci√≥n */
        #ultima {
            position: fixed;
            top: 10px;
            left: 10px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #6B46C1, #9333EA);
            padding: 10px 12px;
            border-radius: 10px;
            border: 2px solid #7C3AED;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            font-size: 12px;
            max-width: 120px;
            word-wrap: break-word;
        }
        
        /* Pr√≥ximo chequeo - box m√°s grande y separado */
        #proximo {
            position: fixed;
            top: 80px;
            left: 10px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #059669, #10B981);
            padding: 12px 16px;
            border-radius: 14px;
            border: 2px solid #047857;
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
            font-size: 14px;
            max-width: 120px;
            word-wrap: break-word;
        }
        
        /* Imagen superior derecha */
        .imagen-superior {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 150px;
            height: 150px;
            border-radius: 10px;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div id="ultima">
        √öltima actualizaci√≥n: {% if ultima_actualizacion %}{{ ultima_actualizacion }}{% else %}N/A{% endif %}
    </div>

    {% if proximo_chequeo %}
    <div id="proximo">
        Pr√≥ximo chequeo {{ proximo_chequeo }}
    </div>
    {% endif %}

    <!-- Imagen superior derecha -->
    <img src="/static/logo.png" alt="Logo" class="imagen-superior" onerror="this.style.display='none'">

    <h1>üîã Registro de Pilas üîã</h1>

    <div class="formularios-container">
        <div class="registro-section">
            <h2>Registrar Pila üìù</h2>
            <form action="/agregar" method="post">
                <div class="campo-linea">
                    <label>Nombre:</label>
                    <select name="nombre" required>
                        <option value="">--Selecciona--</option>
                        <option value="Tlacua">Tlacua</option>
                        <option value="Jasper">Jasper</option>
                        <option value="Caditos">Caditos</option>
                        <option value="Timmy">Timmy</option>
                        <option value="Thunderbird">Thunderbird</option>
                        <option value="Miguelito">Miguelito</option>
                        <option value="Cesar√≠n">Cesar√≠n</option>
                        <option value="El t√≠o">El t√≠o</option>
                        <option value="Chopper">Chopper</option>
                        <option value="Gaia">Gaia</option>
                        <option value="Gipsy">Gipsy</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                    </select>
                </div>

                <div class="campo-linea">
                    <label>Carga (0-130):</label>
                    <input name="carga" type="number" min="0" max="130" required>
                </div>

                <div class="campo-linea">
                    <label>Ohms:</label>
                    <input name="ohms" type="number" step="0.001" required>
                </div>

                <button type="submit">Agregar pila</button>
            </form>
        </div>

        <div class="pila-uso-section">
            <h2>Pila en Uso ‚ö°Ô∏è</h2>
            <form action="/pila_en_uso" method="post">
                Seleccionar pila en uso:
                <select name="nombre" required>
                    <option value="">--Selecciona pila--</option>
                    <option value="Tlacua">Tlacua</option>
                    <option value="Jasper">Jasper</option>
                    <option value="Caditos">Caditos</option>
                    <option value="Timmy">Timmy</option>
                    <option value="Thunderbird">Thunderbird</option>
                    <option value="Miguelito">Miguelito</option>
                    <option value="Cesar√≠n">Cesar√≠n</option>
                    <option value="El t√≠o">El t√≠o</option>
                    <option value="Chopper">Chopper</option>
                    <option value="Gaia">Gaia</option>
                    <option value="Gipsy">Gipsy</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                </select><br><br>
                <button type="submit">Marcar como en uso</button>
            </form>
        </div>

        <div class="recibir-section">
            <h2>Recibir Pila ü™´</h2>
            <form action="/recibir_pila" method="post">
                Seleccionar pila recibida:
                <select name="nombre" required>
                    <option value="">--Selecciona pila--</option>
                    <option value="Tlacua">Tlacua</option>
                    <option value="Jasper">Jasper</option>
                    <option value="Caditos">Caditos</option>
                    <option value="Timmy">Timmy</option>
                    <option value="Thunderbird">Thunderbird</option>
                    <option value="Miguelito">Miguelito</option>
                    <option value="Cesar√≠n">Cesar√≠n</option>
                    <option value="El t√≠o">El t√≠o</option>
                    <option value="Chopper">Chopper</option>
                    <option value="Gaia">Gaia</option>
                    <option value="Gipsy">Gipsy</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                </select><br><br>
                <button type="submit">Marcar como recibida</button>
            </form>
        </div>
    </div>

    <div class="tablas-container">
        <div class="tabla-section">
            <h2>Listado de Pilas</h2>
            <table>
                <tr>
                    <th>Nombre</th>
                    <th>Carga</th>
                    <th>Ohms</th>
                </tr>
                {% for pila in pilas %}
                <tr>
                    <td>{{ pila.nombre }}</td>
                    {% if pila.nombre == pila_en_uso %}
                        <td class="en-uso">En uso</td>
                        <td class="en-uso">En uso</td>
                    {% elif pila.nombre in pilas_en_cooldown %}
                        {% set cooldown_time = pilas_en_cooldown[pila.nombre] %}
                        {% set is_ready = False %}
                        {% for pila_lista in pilas_listas %}
                            {% if pila_lista.nombre == pila.nombre %}
                                {% set is_ready = True %}
                            {% endif %}
                        {% endfor %}
                        {% if is_ready %}
                            <td class="lista-conectar">Lista para conectar</td>
                            <td class="lista-conectar">Lista para conectar</td>
                        {% else %}
                            <td class="en-cooldown">En cooldown</td>
                            <td class="en-cooldown">En cooldown</td>
                        {% endif %}
                    {% elif pila.carga == "Sin datos" %}
                        <td class="lista-conectar">Lista para conectar</td>
                        <td class="lista-conectar">Lista para conectar</td>
                    {% else %}
                        <td>{{ pila.carga }}</td>
                        <td>{{ pila.ohms }}</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </table>
        </div>

        <div class="tabla-section">
            <h2>Pilas Listas para Conectar</h2>
            {% if pilas_listas %}
                <p style="color: #4B0082; font-weight: bold; margin-bottom: 15px;">Orden por tiempo sin conectar (m√°s antiguos primero):</p>
                <ol style="color: #4B0082; text-align: left; font-weight: bold; font-size: 16px; line-height: 1.8;">
                    {% for pila_lista in pilas_listas %}
                        <li style="margin: 10px 0; padding: 8px; background-color: #E6E0F8; border-radius: 5px; border-left: 4px solid #9370DB;">{{ pila_lista.nombre }}</li>
                    {% endfor %}
                </ol>
            {% else %}
                <p style="color: #6B7280; font-style: italic; text-align: center; margin-top: 40px;">No hay pilas listas para conectar en este momento.</p>
            {% endif %}
        </div>
    </div>

    <!-- Bot√≥n de reiniciar -->
    <button class="reiniciar-btn" onclick="confirmarReiniciar()">üîÑ Reiniciar Todo</button>

    <!-- Bot√≥n de informaci√≥n -->
    <button class="info-btn" onclick="mostrarInformacion()">‚ÑπÔ∏è Informaci√≥n</button>

    <script>
        function confirmarReiniciar() {
            if (confirm("‚ö†Ô∏è ¬øEst√°s seguro de que quieres reiniciar TODOS los datos?\n\n\n\n ‚ö†Ô∏è No deber√≠as hacerlo por nada en teor√≠a ‚ö†Ô∏è\n‚Ä¢ ")) {
                // Si el usuario confirma, enviar formulario
                document.getElementById('reiniciarForm').submit();
            }
        }

        function mostrarInformacion() {
            const info = `üìã Instrucciones
            
1Ô∏è‚É£ Cada media hora, capturar en "Registrar Pila", el estado actual de cada pila que se encuentre conectada.
2Ô∏è‚É£ Al momento de utilizar una pila, registrarla en "Pila en Uso". 
3Ô∏è‚É£Cuando la pila es retirada del robot, registrarla en "Recibir Pila" para iniciar el cooldown de 30 minutos.
4Ô∏è‚É£ La informaci√≥n se debe actualizar cada media hora

üéØ ORDEN DE CONEXI√ìN:
Las pilas listas se ordenan por tiempo sin conectar (m√°s antiguos primero)

‚ö†Ô∏è RESET:
El bot√≥n "Reiniciar Todo" borra TODOS los datos permanentemente

‚ö†Ô∏è IMPORTANTE:
‚Ä¢ No registrar pilas que no est√©n conectadas, en cooldown o en uso
‚Ä¢ Si se puede dar refresh, esto actualizar√° los temporizadores de cooldown


üî¥ Esta dise√±ado para que una sola computadora modifique los datos, si quieren cambiar de computadora, deben subir a github los cambios o bien, compartir el contenido del .json y reemplazarlo en la nueva computadora

Dudas, comentarios o sugerencias me pueden decir (Rigo)

`;

            alert(info);
        }
    </script>

    <!-- Formulario oculto para reiniciar -->
    <form id="reiniciarForm" action="/reiniciar" method="post" style="display: none;">
    </form>
</body>
</html>
